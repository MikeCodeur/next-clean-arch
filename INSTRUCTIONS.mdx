# Autorisation - Dynamique UI

### 💡 Affichage Dynamique en fonction de l’autorisation

## 📝 Tes notes

Detaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Dans les exercices précédents, nous avons bloqué des routes en fonctions des rôles, nous avons aussi protéger l’appel aux actions.

Mais avec les règles d’autorisation, il est possible de gérer des affichages différents, comme par exemple des boutons ou menus supplémentaires en fonction du type d’utilisateur .

## Exercice

👨‍✈️ Hugo le chef de projet te demande de conditionner l’affichage des 2 buttons suivants en fonction du Rôle `Manager` ou `Admin`

- Ajout Rapide ([http://localhost:3000/shop-admin/1](http://localhost:3000/shop-admin/1))
- Ajout Détaillé ([http://localhost:3000/shop-admin/quick](http://localhost:3000/shop-admin/quick))

🐶 Pour cela tu vas devoir modifier les composants de routes (`page.tsx`) et utiliser

- `canQuickAdd`
- `canMutateProduct`

ps : Utilise la propriété `hidden` de `tailwind` et `cn` de `shadcn`

```tsx
className={cn({hidden: !canEdit})}
```

Fichiers

- `(dashboard)/shop-admin/[page]/page`
- `(dashboard)/shop-admin/quick/page`

## Bonus

### 1. 🚀 Menu Dynamique

**👨‍✈️ Hugo le chef de projet** : te demande d’avoir un menu du `dashboard` qui s’adapte en fonction du rôle.

- 🐶 Utilise `hasRequiredRole` dans le `layout` du `dashboard` pour conditionner l’affiche des menus

Exemple :

```tsx
const user = await getConnectedUser()
hasRequiredRole(user, RoleEnum.USER)
```

Fichiers

- `(dashboard)/layout.tsx`

### 2. 🚀 Menu Dynamique - Configuration

Les menus sont des choses qui bougent souvent et que l’on peut retrouver dans diffèrent composants (`mobile-menu` / `menu-drawer` etc …). Il est donc important de centraliser la configuration des menus en fonction des rôles.

Pour cela nous avons ajouter un fichier `dashboard-menu.ts`

```tsx

export const dashboardMenu: Record<RoleEnum, MenuItem[]> = {
  [RoleEnum.GUEST]: [{label: 'Home', href: '/'}],
  [RoleEnum.USER]: [
    {label: 'Home', href: '/'},
    {label: 'Dashboard', href: '/dashboard'},
    {label: 'Bank', href: '/bank'},
  ],
  [RoleEnum.ADMIN]: [
    {label: 'Home', href: '/'},
    {label: 'Dashboard', href: '/dashboard'},
    {label: 'Admin', href: '/shop-admin/1'},
 ...
}
getMenuByRole
```

- **🐶 Utilise la fonction** `getMenuByRole` pour afficher le menu dynamiquement

```tsx
const menuItems = getMenuByRole(userRole)
...
 {menuItems.map((menuItem) => (
```

Fichiers

- `(dashboard)/layout.tsx`

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=Clean%20Architecture&entry.533578441=07%20Authorization%20dynamic-ui).
