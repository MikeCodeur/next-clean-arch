# Optimisation

### ğŸ’¡ Optimiser lâ€™application

## ğŸ“ Tes notes

Detaille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Faire fonctionner lâ€™application correctement câ€™est une chose. Mais il faut aussi sâ€™assurer des performances.

Un des premier critÃ¨re a regarder câ€™est la gÃ©nÃ©ration des pages statiques vs dynamiques. Dans notre cas elle sont toutes rendu dynamiquent (Æ’).

```bash
Route (app)                              Size     First Load JS
â”Œ Æ’ /                                    9.26 kB         153 kB
â”œ â—‹ /_not-found                          148 B           101 kB
â”œ Æ’ /bank                                1.32 kB         109 kB
â”œ Æ’ /bank/[uid]                          1.56 kB         109 kB
â”œ Æ’ /dashboard                           1.43 kB         145 kB
â”œ Æ’ /instructions                        4.12 kB         105 kB
â”œ Æ’ /last-users                          4.6 kB          125 kB
â”œ Æ’ /logout                              2.09 kB         119 kB
â”œ Æ’ /privacy                             148 B           101 kB
â”œ Æ’ /redactor                            148 B           101 kB
â”œ Æ’ /restricted                          175 B           110 kB
â”œ Æ’ /shop-admin                          148 B           101 kB
â”œ Æ’ /shop-admin/[page]                   35.1 kB         179 kB
â”œ Æ’ /shop-admin/quick                    2.67 kB         120 kB
â”œ Æ’ /sign-in                             2.39 kB         119 kB
â”œ Æ’ /sign-up                             2.47 kB         119 kB
â”” Æ’ /terms                               148 B           101 kB
+ First Load JS shared by all            101 kB
  â”œ chunks/428-5cc3bc366b3773bd.js       45.7 kB
  â”œ chunks/46f14785-7f61c0f37941c5a3.js  52.9 kB
  â”” other shared chunks (total)          1.86 kB
```

Câ€™est normal pour les pages ou lâ€™utilisateur doit Ãªtre connectÃ©. Mais pour les pages publiques la plupart devraient Ãªtre statique

- `privacy`
- `terms`

Or la elles ne le sont pas

```tsx

â”œ Æ’ /privacy
â”” Æ’ /terms
```

Nous allons corriger cela

## Exercice

- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : te demande de corriger cela

Fichiers

- `(public)/layout.tsx`

## Bonus

### 1. ğŸš€ **Incremental Static Regeneration (ISR)**

La page des [derniers utilisateurs inscris](http://localhost:3000/last-users) est dynamique. Câ€™est une bonne chose car nous voulons voir les derniers utilisateurs inscris.

```tsx
export const dynamic = 'force-dynamic'

export default async function Page() {
...
```

Cependant ce nâ€™est pas optimisÃ© car lâ€™ajout de nouveaux utilisateurs nâ€™est pas frÃ©quent et la fonctionnalitÃ© nâ€™est pas critique.

Nous pouvons nous permettre dâ€™avoir un rafraichissement toutes les minutes par exemple.

- **ğŸ¶ implÃ©mente cela**

https://nextjs.org/docs/app/building-your-application/data-fetching/incremental-static-regeneration

Fichiers

- `(public)/last-users.tsx`

### 2. ğŸš€ Cache

Il faut Ã©galement vÃ©rifier le cache sur les appels de data.

https://nextjs.org/docs/app/building-your-application/data-fetching/fetching

Si lâ€™application contient des appel fetch et que lâ€™on souhait mettre en cache

```tsx
let res = await fetch(`https://api.vercel.app/blog/${id}`, {
    cache: 'force-cache',
 )
```

On peut mettre aussi en cache les donnÃ©es via le DAL (Data AccÃ¨s Layer) avec `React Cache`, exemple pour notre `getConnectedUser`

```tsx
export const getConnectedUser = cache(async () => {
  try {
    const user = await getAuthUser()
    return userDTO(user)
  } catch (error) {
    console.error('Failed to fetch user', error)
    return
  }
})
```

- **ğŸ¶ Dans cet exercice tu vas mettre en cache les appel au `product service` en creant un `product-dal.ts`**

Fichiers

- `exercise/about/**product-dal.ts**`

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis).
