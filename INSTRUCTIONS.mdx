# Optimisation

### 💡 Optimiser l’application

## 📝 Tes notes

Detaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Faire fonctionner l’application correctement c’est une chose. Mais il faut aussi s’assurer des performances.

Un des premier critère a regarder c’est la génération des pages statiques vs dynamiques. Dans notre cas elle sont toutes rendu dynamiquent (ƒ).

```bash
Route (app)                              Size     First Load JS
┌ ƒ /                                    9.26 kB         153 kB
├ ○ /_not-found                          148 B           101 kB
├ ƒ /bank                                1.32 kB         109 kB
├ ƒ /bank/[uid]                          1.56 kB         109 kB
├ ƒ /dashboard                           1.43 kB         145 kB
├ ƒ /instructions                        4.12 kB         105 kB
├ ƒ /last-users                          4.6 kB          125 kB
├ ƒ /logout                              2.09 kB         119 kB
├ ƒ /privacy                             148 B           101 kB
├ ƒ /redactor                            148 B           101 kB
├ ƒ /restricted                          175 B           110 kB
├ ƒ /shop-admin                          148 B           101 kB
├ ƒ /shop-admin/[page]                   35.1 kB         179 kB
├ ƒ /shop-admin/quick                    2.67 kB         120 kB
├ ƒ /sign-in                             2.39 kB         119 kB
├ ƒ /sign-up                             2.47 kB         119 kB
└ ƒ /terms                               148 B           101 kB
+ First Load JS shared by all            101 kB
  ├ chunks/428-5cc3bc366b3773bd.js       45.7 kB
  ├ chunks/46f14785-7f61c0f37941c5a3.js  52.9 kB
  └ other shared chunks (total)          1.86 kB
```

C’est normal pour les pages ou l’utilisateur doit être connecté. Mais pour les pages publiques la plupart devraient être statique

- `privacy`
- `terms`

Or la elles ne le sont pas

```tsx

├ ƒ /privacy
└ ƒ /terms
```

Nous allons corriger cela

## Exercice

- **👨‍✈️ Hugo le chef de projet** : te demande de corriger cela

Fichiers

- `(public)/layout.tsx`

## Bonus

### 1. 🚀 **Incremental Static Regeneration (ISR)**

La page des [derniers utilisateurs inscris](http://localhost:3000/last-users) est dynamique. C’est une bonne chose car nous voulons voir les derniers utilisateurs inscris.

```tsx
export const dynamic = 'force-dynamic'

export default async function Page() {
...
```

Cependant ce n’est pas optimisé car l’ajout de nouveaux utilisateurs n’est pas fréquent et la fonctionnalité n’est pas critique.

Nous pouvons nous permettre d’avoir un rafraichissement toutes les minutes par exemple.

- **🐶 implémente cela**

https://nextjs.org/docs/app/building-your-application/data-fetching/incremental-static-regeneration

Fichiers

- `(public)/last-users.tsx`

### 2. 🚀 Cache

Il faut également vérifier le cache sur les appels de data.

https://nextjs.org/docs/app/building-your-application/data-fetching/fetching

Si l’application contient des appel fetch et que l’on souhait mettre en cache

```tsx
let res = await fetch(`https://api.vercel.app/blog/${id}`, {
    cache: 'force-cache',
 )
```

On peut mettre aussi en cache les données via le DAL (Data Accès Layer) avec `React Cache`, exemple pour notre `getConnectedUser`

```tsx
export const getConnectedUser = cache(async () => {
  try {
    const user = await getAuthUser()
    return userDTO(user)
  } catch (error) {
    console.error('Failed to fetch user', error)
    return
  }
})
```

- **🐶 Dans cet exercice tu vas mettre en cache les appel au `product service` en creant un `product-dal.ts`**

Fichiers

- `exercise/about/**product-dal.ts**`

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis).
